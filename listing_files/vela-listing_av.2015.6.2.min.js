jQuery(function(b){var c={isMobile:b("html").hasClass("touch"),labels:b("#listing").data("txt"),photoSelector:"#listing .offer .photo",photoInnerSelector:"#listing .offer .photo .inner",cartClient:null,init:function(){c.preview.init();c.live.init();c.sorting.init();c.sidebar.init();c.message.init();c.tip.init();c.views.init();c.bestmatchstats.init();c.brandzoneFeatures.init();b("#listing").on("mousedown",".offer",c.bestmatchstats.clickItem).on("click",".offer",c.offer.click);b("#offer-preview").on("mousedown", ".item-cart",c.bestmatchstats.clickItem);b("#main-search").on("submit",c.search.extend);if(c.isCartHeaderLoaded()){var a=b.cookie("cartUserId");c.cartClient=new window.CartClient(a,"/cart/","/carts/");if(c.cartClient.isResponsiveCartEnabled())b("#offer-preview").on("click",".item-cart",c.sendItemToCart);else b("#offer-preview").on("click",".item-cart",c.setAddToCartHref)}},isCartHeaderLoaded:function(){return"undefined"!==typeof window.CartClient},sendItemToCart:function(a){a.preventDefault();if(c.isCartHeaderLoaded()){a= b(this).data("id").toString();var d=parseInt(b(this).parent().parent().find(".buy-now").text().match(/[0-9]/g).join(""),10),f=parseInt(b(this).parent().parent().find(".amount strong:first").text(),10);c.cartClient.addItemToCart(a,1,d,f)}},setAddToCartHref:function(){var a=b(this).data("href");b(this).attr("href",a)},pageViewsParamsFunction:function(){var a=/[\?&]bmatch=([^&#]*)/.exec(window.location.href),d=b("#breadcrumbs-list").data("cat-path-ids"),c=b("#main-breadcrumb-search-hits").html(),c=c? c.match(/^\((\d+).+/):!1,e=b("#main-search-text").val(),d={cat:d?d.toString().split(","):[],st:b("div.listing-sort-dropdown div.options dd.selected").data("order"),page:b("#pager-value").val(),lsv:"old",lcv:b.cookie("newListing")?parseInt(b.cookie("newListing"),10):0};e&&(d.search=e,d.bmv=a?a[1]:0,d.cnt=c?c[1]:"");return d},cmEventCatStringFunction:function(){return b("#main-search-text").val()?"Search":"Listing"},sendAnalytics:function(a){if(window.cm)try{a()}catch(b){}},offer:{click:function(a){var d= b(a.target).closest("article").find("h2 > a"),d=d[0]?d[0].href:void 0;1!==a.which||a.ctrlKey||a.metaKey||a.shiftKey?c.offer.sendShowItemClickEventData(this):(a.preventDefault(),c.offer.sendShowItemClickEventData(this,d),c.offer.fallbackRedirect(d,300));1!==a.which||a.ctrlKey||a.metaKey||a.shiftKey||b.proxy(c.live.events.pushWindowScroll,this)()},sendShowItemClickEventData:function(a,d){var f=function(){var d=c.pageViewsParamsFunction();d.it={pos:b(a).index(),id:b(a).data("id"),promo:"featured-offers"=== b(a).parent("section").attr("id")};return d},e={};d&&(e={onSuccess:function(){document.location.assign(d)},onFailure:function(){document.location.assign(d)}});c.sendAnalytics(function(){window.cm.event({cat:c.cmEventCatStringFunction(),a:"ShowItem"},f,e)})},fallbackRedirect:function(a,b){setTimeout(function(){document.location.assign(a)},b)}},preview:{element:b('<article id="offer-preview" class="offer-preview"></article>').appendTo("body"),additionalData:null,showTimeout:null,closeTimeout:null,mouseover:!1, settings:{showDelay:300,closeDelay:200},init:function(){c.isMobile||c.preview.events()},events:function(){b("#listing").on("mouseenter",".offer .photo:not([data-hidetooltip=1])",c.preview.cancel).on("mouseenter",".offer .photo:not([data-hidetooltip=1])",c.preview.show).on("mousemove",".offer .photo:not([data-hidetooltip=1])",c.preview.cancel).on("mousemove",".offer .photo:not([data-hidetooltip=1])",c.preview.show).on("mouseleave",".offer .photo:not([data-hidetooltip=1])",c.preview.cancel).on("mouseleave", ".offer .photo:not([data-hidetooltip=1])",c.preview.close);b("#offer-preview").on("click","header a, .gallery .photo a",c.live.events.pushWindowScroll);b(window).bind("unload",c.preview.close);c.preview.element.on("mouseenter",function(){c.preview.mouseover=!0;clearTimeout(c.preview.closeTimeout)}).on("mouseleave",function(){c.preview.mouseover=!1;c.preview.closeTimeout=setTimeout(function(){c.preview.element.hide()},c.preview.settings.closeDelay)})},show:function(){var a=c.preview.settings.showDelay, d,f,e=b(this).parents(".offer").eq(0),g=b(window).scrollTop();c.live.requestLocked||(c.preview.additionalData||(d=(new Date).getTime(),c.preview.getAdditionalData(),f=(new Date).getTime(),a=f-d>a?0:a-(f-d)),c.preview.showTimeout=setTimeout(function(){b(window).scrollTop()<g-e.find(".photo").height()||b(window).scrollTop()>g+e.find(".photo").height()||(c.preview.element.toggleClass("offer-preview-gallery",b("#listing").is(".listing-gallery")),c.preview.element.show(),c.preview.setPosition(e),c.preview.setContent(e), c.preview.styleScrolls())},a))},close:function(){c.preview.closeTimeout=setTimeout(function(){c.preview.mouseover||c.preview.element.hide()},c.preview.settings.closeDelay)},cancel:function(){clearTimeout(c.preview.closeTimeout);clearTimeout(c.preview.showTimeout)},setPosition:function(a){var d=c.preview.element.outerWidth(!0),f=b("#listing").is(".listing-simple")?130:100,e=b("#listing").is(".listing-gallery")?(b(".listing-gallery .offer").outerWidth()-d)/2:a.find(".photo").outerWidth()/2+40,f=a.offset().top- f;a=a.offset().left+e;var d=d-(b(window).width()-a),e=f-(b("#search-bar").outerHeight()+b(window).scrollTop()+10),g=0;0<d&&(a-=d);0>e&&(f=b("#search-bar").outerHeight()+b(window).scrollTop()+10);c.preview.element.css({left:a,top:f});g=b(window).height()+b(window).scrollTop()-(f+c.preview.element.outerHeight());0>g&&(f=b(window).height()+b(window).scrollTop()-c.preview.element.outerHeight()-10,c.preview.element.css({left:a,top:f}))},setContent:function(a){var d=0,f=b('<div class="gallery"><div class="photo"><a href="'+ a.find("h2 a").attr("href")+'"></a></div><span class="prev"><span></span></span><span class="next"><span></span></span><ul class="nav"></ul></div>'),e=b('<div class="excerpt"></div>').html(a.find(".excerpt").html()).find(".photo").remove().end(),g=e.find(".params").clone(),h=a.find(".photo").data("external");e.find(".params").remove();b.each(a.find(".photo").data("img"),function(){var a=this[this.length-1];f.find("ul").append('<li><a href="'+a+'"><span></span></a></li>')});b("#listing").is(".listing-gallery")&& e.find(".details").after(e.find(".purchase"));a.hasClass("promo-bold")?c.preview.element.addClass("offer-preview-promo-bold"):c.preview.element.removeClass("offer-preview-promo-bold");c.preview.element.html(e.html()).data("id",a.data("id"));c.preview.element.find(".details").after(f);f.after(g);f.find(".nav a").click(function(){d=b(this).parent("li").index();b(this).parent("li").addClass("current").siblings().removeClass("current");f.find(".photo").css("background-image","url("+b(this).attr("href")+ ")");h[d]?f.find(".photo").append('<span class="desc">'+c.labels.samplePhoto+"</span>"):f.find(".photo .desc").remove();return!1});f.find(".nav a").eq(0).click();1>=f.find(".nav a").length&&f.find(".prev, .next, .nav").hide();f.find(".prev, .next").click(function(a){a.stopPropagation();d=b(this).is(".prev")?d-1:d+1;d%=f.find(".nav a").length;f.find(".nav a").eq(d).click()}).hover(function(){c.preview.element.find("header h2 a").removeClass("hovered")});f.find(".photo").hover(function(){c.preview.element.find("header h2 a").addClass("hovered")}, function(){c.preview.element.find("header h2 a").removeClass("hovered")});c.preview.element.find(".item-watch").click(c.preview.addToWatch);c.tip.init(c.preview.element)},addToWatch:function(a){this.href.match("/myaccount/watch.php")||(a.preventDefault(),b.ajax({url:"/Watchlist.php",type:"post",data:{itemId:b(this).parents(".offer-preview").data("id"),backUrl:window.location.href,token:b("#listing").data("popup").token},dataType:"json",success:function(a){if(a)switch(a.status){case 0:c.preview.addedToWatch({status:1, link:"/myaccount/watch.php"});break;case 1:c.preview.addedToWatch({status:0,error:a.message});break;case 2:window.location.assign(a.message)}}}))},addedToWatch:function(a){var d=c.preview.element.find(".item-watch");a.status&&a.link?d.attr("href",a.link).children().html(d.data("lang")):a.error&&(c.preview.element.prepend(b('<p class="error">'+a.error+"</p>")),setTimeout(function(){c.preview.element.find(".error").fadeOut(100).remove()},5E3))},getAdditionalData:function(){var a={},d;a.itemData={}; a.pagerLimit=b("#listing .listing-options-bottom .items-per-page .current").text();a.token=b("#listing").data("popup").token;b("#listing .offer").each(function(){d=b(this);a.itemData[d.data("id")]=d.find(".photo").data("popup")});a.itemData&&a.pagerLimit&&a.token&&b.ajax({url:"/Listing/AdditionalData.php/getAjax",data:{items:a.itemData,pagerLimit:a.pagerLimit,token:a.token},type:"post",async:!1,dataType:"json",success:function(b){b.data&&(a.popupData=b.data,c.preview.dataReceived(a))}})},dataReceived:function(a){var d, f,e;c.preview.additionalData=a;for(f in a.popupData)e=b('#listing .offer[data-id="'+f+'"]'),d=e.find(".products .user"),d.prepend(a.popupData[f].s.listingLink),a.popupData[f].cartEnabled&&e.find(".item-cart").removeClass("disabled"),(d=c.preview.renderAttributes(a.popupData[f].attributes))?e.find(".params.params-all").html("<dl>"+d.toLowerCase()+"</dl>"):e.find(".params.params-all").remove()},renderAttributes:function(a){var b,c,e,g=[];for(e in a)b=a[e],c="",""!==b.value&&(c="string"===typeof b.value? c+("<dd><span>"+b.value+"</span></dd> "):c+("<dd><span>"+b.value.join("</span></dd> <dd><span>")+"</span></dd> "),""!==b.unit&&(c+='<dd class="unit"><span>'+b.unit+"</span></dd> "),c="enum"===b.type||"region"===e?' <dt class="enum"><span>'+b.name+"</span></dt>"+c:" <dt><span>"+b.name+"</span></dt>"+c),g.push(c);return g.join("")},styleScrolls:function(){var a=c.preview.element.find(".params-all dl"),b=parseInt(a.height(),10);a.length&&a[0].scrollHeight>b&&(a.css("max-height","none"),a.wrap('<div class="overview" />'), a.parents(".overview").wrap('<div class="viewport" />'),a.parents(".viewport").wrap('<div class="scrollbar-area" />'),a=a.parents(".scrollbar-area"),a.prepend('<div class="scrollbar"><div class="track"><div class="thumb"></div></div></div>'),a.find(".viewport").css({height:b}),a.tinyscrollbar({invertscroll:c.isMobile}))}},live:{initialUrl:location.href,popped:!1,requestLocked:!1,requestStash:{},requestObject:null,init:function(){c.live.transform();c.live.events.init()},restoreInitState:function(){c.live.initialUrl= location.href},events:{settings:{pushStateEnabled:void 0!==window.history.pushState&&b("#listing").data("is-live-search-active"),selectInput:!1,pagerValue:b("#pager-value").val(),requestTimeout:null},init:function(){b("#pager-value").length&&(b("#listing").on("keyup","#pager-value",c.live.events.pagerInputKeyUp).on("keypress","#pager-value",c.live.events.pagerInputKeyPress).on("mousedown","#pager-value",c.live.events.pagerInputMouseDown).on("click","#pager-value",c.live.events.pagerInputClick),c.live.resizePager(), b("#pager-value").keyup());b("#display-form").on("keypress","input[type=text]",c.live.events.paramTextKeyPress).on("keyup","input[type=text]",c.live.events.paramTextKeyUp).on("focus","input[type=text]",c.live.events.paramTextFocus).on("blur","input[type=text]",c.live.events.paramTextBlur).on("change","select",c.live.events.paramSelectChange).on("click","a.param-toggle",c.live.events.paramToggleClick);c.live.events.settings.pushStateEnabled?(b("#listing").on("click",".pager a, .listing-sort-dropdown .options a", c.live.events.pagerNavClick),b("#listing").on("click",".items-per-page a",c.live.events.changePageLimit),b("#display-form").on("change","input[type=checkbox], input[type=radio]",c.live.events.paramSwitchChange),b("#sidebar-params .widget-header .action-reset").click(c.live.events.resetForm),b(window).on("popstate",c.live.events.popState)):(b("#sidebar-params").on("click",".widget-header .action-reset",c.live.events.pushWindowScroll),c.live.autoScroll());b(window).bind("unload",c.live.restoreInitState)}, dependenciesCheck:{multiRegion:{regionAllCountry:function(a){var d=c.urlParams(),f=b("ul.multi-region"),e=b("li.multi-region-all-country"),g={},h,k=/multiRegion(.*)/,l;if(0<e.length&&0<e.find(a).length)for(h in d)l=k.exec(h),null!==l&&"[allCountry]"!==l[1]&&(g[h]="");else if(0<f.find(a).length)for(h in d)h.match(/multiRegion\[allCountry\]/)&&(g[h]="");if(null!==k.exec(a.attr("href"))){if(void 0===d.postcode_enabled||void 0!==d.postcode_enabled&&"0"!==d.postcode_enabled)g.postcode_enabled="0";void 0!== d.city&&(g.city="")}else if(0<f.find(a).length||0<e.find(a).length)g.postcode_enabled="";return g},regionCity:function(a){var d=c.urlParams(),f=b("ul.multi-region-city"),e={},g;if(0<f.length&&0<f.find(a).length)for(g in d)g.match(/multiRegion/)&&(e[g]="");return e}}},pagerInputKeyUp:function(){c.live.changePagerNavAction();c.live.resizePager(200)},pagerInputKeyPress:function(a){a=a.which?a.which:a.keyCode;return 13===a?(a=parseInt(encodeURI(b(this).val().replace(/[^\d]*/g,"")),10),a=c.live.changeParams({params:{p:a}, href:window.location.href}),c.live.events.settings.pushStateEnabled?c.live.request({url:a}):window.location.href=a,!1):48<=a&&57>=a||-1!==b.inArray(a,[37,38,39,40,46,8])?!0:!1},pagerInputMouseDown:function(){c.live.events.settings.selectInput=!b(this).is(":focus")},pagerInputClick:function(){c.live.events.settings.selectInput&&b(this).select()},pagerNavClick:function(){c.live.request({counters:!1,url:b(this).attr("href"),scroll:b(this).parents(".pager-bottom").length?0:!1});return!1},changePageLimit:function(){var a= c.urlParams(),d=c.urlParams(b(this).attr("href")),f=a.limit?a.limit:60,a=a.p?a.p:1,d=d.limit?d.limit:60,e=Math.ceil(((a-1)*f+b(".listing .offer").length)/d),f=Math.min(Math.ceil(a*f/d),e),a=b("#listing .offer:last"),g=a.attr("id"),h=a.offset().top-b(window).scrollTop(),f=1<f?f:"";c.live.request({url:c.live.changeParams({params:{p:f},href:b(this).attr("href"),lastPage:f}),callback:function(){var a=b("#listing").find("#"+g);a.length&&b(window).scrollTop(Math.ceil(a.offset().top-h))}});return!1},paramTextKeyPress:function(a){var b= a.which?a.which:a.keyCode;c.live.events.settings.pushStateEnabled&&13===b&&a.preventDefault()},paramTextKeyUp:function(a){var d=a.which?a.which:a.keyCode,f=b(this);b(window).scrollTop();b("#sidebar-params").offset();var e={};a=13===d?0:850;var g,h,e=c.live.events.dependenciesCheck.multiRegion.regionCity(f);if(c.live.events.settings.pushStateEnabled)clearTimeout(c.live.events.settings.requestTimeout),c.live.events.settings.requestTimeout=setTimeout(function(){if(g=c.live.dependentParamsValid(f)&&-1=== b.inArray(d,[9,16,35,36,37,38,39,40]))h=c.live.getOptionUrl(f,e),c.live.request({url:h})},a);else if(g=c.live.dependentParamsValid(f)&&13===d)b.proxy(c.live.events.pushWindowScroll,this)(),h=c.live.getOptionUrl(f,e),window.location.href=h},paramTextFocus:function(){clearTimeout(c.live.events.settings.requestTimeout)},paramTextBlur:function(){var a=b(this),d={},f,e=c.live.dependentParamsValid(a),d=c.live.events.dependenciesCheck.multiRegion.regionCity(a);e&&(c.live.events.settings.requestTimeout=setTimeout(function(){if(c.live.events.settings.pushStateEnabled)f= c.live.getOptionUrl(a,d),c.live.request({url:f});else if(b.proxy(c.live.events.pushWindowScroll,a[0])(),f=c.live.getOptionUrl(a,d),e=f.replace(/&scrollTop=[^&]*/,"")!==window.location.href.replace(/&scrollTop=[^&]*/,""))window.location.href=f},50))},paramSelectChange:function(){var a=b(this),d={},f=c.urlParams(),e=a.parents("li").eq(0).find("input[type=checkbox], input[type=radio]").eq(0);!c.live.dependentParamsValid(a)||"undefined"!==typeof f[b(this).attr("name")]&&f[b(this).attr("name")]===b(this).val()&& e.is(":checked")||(clearTimeout(c.live.events.settings.requestTimeout),c.live.events.settings.pushStateEnabled?(a=c.live.getOptionUrl(a),c.live.request({url:a})):(b.proxy(c.live.events.pushWindowScroll,this)(),a=c.live.getOptionUrl(a,d),window.location.href=a))},paramToggleClick:function(a){var d={},f=b(this).attr("href"),e;e=b(this);if(c.live.events.settings.pushStateEnabled)return a=b(this).parents("li").eq(0).find("input[type=checkbox], input[type=radio]").eq(0),e=c.live.requestLocked?0:100,d= c.live.events.dependenciesCheck.multiRegion.regionAllCountry(b(this)),c.live.requestStash=b.extend(c.live.requestStash,c.live.getOptionParams(a)),f=c.live.getOptionUrl(a,d),a.click(),clearTimeout(c.live.events.settings.requestTimeout),c.live.events.settings.requestTimeout=setTimeout(function(){c.live.request({url:f})},e),!1;a.preventDefault();b.proxy(c.live.events.pushWindowScroll,this)();c.live.autoScroll();d=c.live.events.dependenciesCheck.multiRegion.regionAllCountry(e);b.isEmptyObject(d)||(f= c.live.getOptionUrl(e,d));window.location.href=f},paramSwitchChange:function(){b('input[name="'+b(this).attr("name")+'"]').each(function(){b(this).is(":checked")?b(this).parent().find("a").addClass("checked"):b(this).parent().find("a").removeClass("checked")})},popState:function(){location.href!==c.live.initialUrl&&(c.live.request({url:location.href,pop:!0}),"state.title"in window.history&&(document.title=window.history.state.title))},resetForm:function(){c.live.request({url:b(this).attr("href")}); return!1},pushWindowScroll:function(){var a=!c.live.events.settings.pushStateEnabled&&window.sessionStorage&&0<b(this).parents("ul").length;b(this).is(".offer")||0<b(this).parents("#offer-preview").length?window.localStorage.setItem("scrollToOffer",JSON.stringify({offset:b(window).scrollTop()-b("#listing").offset().top,location:window.location.href})):a&&window.sessionStorage.setItem("toggleList",JSON.stringify({windowListOffset:parseInt(b(this).parents("ul").offset().top-b(window).scrollTop(),10), toggleListIndex:parseInt(b(this).parents("ul").index(".sidebar .widget-params fieldset ul"),10),toggleListExpand:b(this).parents(".scrollbar-area").hasClass("params-limit-more")?1:0,toggleListOffset:Math.abs(parseInt(b(this).parents(".overview").css("top"),10))}))},popWindowScroll:function(){var a=window.sessionStorage&&window.sessionStorage.getItem("toggleList")&&JSON.parse(window.sessionStorage.getItem("toggleList")),b=a&&!c.live.events.settings.pushStateEnabled&&"undefined"!==typeof a.toggleListIndex, f=window.localStorage&&window.localStorage.getItem("scrollToOffer")&&JSON.parse(window.localStorage.getItem("scrollToOffer"));b?c.live.autoScroll({storage:a}):f&&(f.location===window.location.href&&c.live.autoScroll({scrollToOffer:f.offset}),window.localStorage.removeItem("scrollToOffer"))}},dependentParamsValid:function(a){var c=a.data("dependent"),f=!0,e,g;if(a.hasClass("input-error"))f=!1;else for(g in c){e=b('[name="'+c[g]+'"]');var h;if(h=e.length){a:{if(""===a.val()||a.hasClass("placeholder")){if(""!== e.val()&&!e.hasClass("placeholder")||e.hasClass("input-error")){e=!1;break a}}else if(""===e.val()||e.hasClass("placeholder")||e.hasClass("input-error")){e=!1;break a}e=!0}h=!e}if(h){f=!1;break}}return f},changeParams:function(a){var c=function(){var c=a.params.p,d=a.lastPage?a.lastPage:parseInt(b("#pager-top").attr("rel"),10);return 1<c?c>d?d:c:""}(),f,e,g,h;a.params=b.extend({counters:"",msg:"",requestCategory:"",requestDepartment:"",fallback:""},a.params);b.each(b("#listing").data("excludedparameters"), function(b,c){a.params[c]=""});a.params.p=c;a.href=a.href?a.href:window.location.href;h=decodeURI(a.href.replace(/%25/g,"%2525"));for(f in a.params)c=a.params[f],e=new RegExp("[?&]"+f.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"=[^&]*","g"),g=h.match(e),""===c&&g?h="?"===g[0][0]?h.replace(e,"?"):h.replace(e,""):""!==c&&(h=g?h.replace(e,g[0][0]+f+"="+c):-1!==h.indexOf("?")?h+"&"+f+"="+c:h+"?"+f+"="+c);h=h.replace("?&","?");if("?"===h[h.length-1]||"&"===h[h.length-1])h=h.substr(0,h.length- 1);h=encodeURI(h);return h=h.replace(/%25/g,"%")},changeCounters:function(a,c,f){var e,g,h,k,l,m,n=!1;e=0;var q=b("#sidebar-categories").data("root-category-name"),r=b("#main-breadcrumb-search-hits");if(void 0!==a){for(l in a.paramCounts)for(m in a.paramCounts[l])h=b('input[name="'+l+'"][value="'+m+'"]'),1!==h.length&&(h=b("#"+l+"_"+m)),e=a.paramCounts[l][m],h.is("input")?(g=h.parent().find(".count"),k=b('label[for="'+h.attr("id")+'"]'),g.text(" ("+e+")"),0<e?k.removeClass("disabled"):k.addClass("disabled")): h.is("option")&&h.text(h.text().replace(/\(\d*\)$/,"("+e+")")),h.parents("li").attr("data-custom-order",e).data("customOrder",e);for(l in a.attribCounts)h=b('input[name="'+l+'"]'),g=h.parent().find(".count"),e=a.attribCounts[l],k=b('label[for="'+h.attr("id")+'"]'),g.text(" ("+e+")"),0<e?k.removeClass("disabled"):k.addClass("disabled"),h.parents("li").attr("data-custom-order",e).data("customOrder",e)}if(void 0!==c){b(".sidebar-cat").addClass("empty");b(".sidebar-cat .count").text(" (0)");for(l in c)h= b("#sidebar-cat-"+l),g=h.find(".count"),e=c[l],g.text(" ("+e+")"),0!==e&&(h.removeClass("empty"),n=!0);b("#sidebar-categories .widget-nav ul .parent-empty").remove();!1===n&&(e=b("#sidebar-categories").data("current-category-id"),0<e&&(q=b("#sidebar-categories").data("current-category-name")),0===b("#sidebar-categories .widget-nav ul .current").length&&b("#sidebar-categories .widget-nav ul").append('<li id="sidebar-cat-'+e+'" class="sidebar-cat current parent-empty"><span class="name">'+q+'</span><span class="count"> (0)</span></li>'))}void 0!== f&&0!==f.length&&0<r.length&&r.text(" ("+f+")")},autoScroll:function(a){a=b.extend({scrollToOffer:null,scrollToParam:null,storage:null,parameters:c.urlParams()},a);a.scrollToParam?b(window).scrollTop(Math.ceil(a.scrollToParam)+b("#sidebar-params").offset().top):a.scrollToOffer?b(window).scrollTop(Math.ceil(a.scrollToOffer)+b("#listing").offset().top):a.storage?(b(window).scrollTop(b(".sidebar .widget-params ul").eq(a.storage.toggleListIndex).offset().top-a.storage.windowListOffset),window.sessionStorage.removeItem("toggleList")): a.parameters.scrollTop&&b(window).scrollTop(parseInt(a.parameters.scrollTop,10)+b("#sidebar-params").offset().top)},getClearUrl:function(){var a=["a_mask","a_text","a_enum","a_date"],d="",f={},e=c.urlParams();for(d in e)(e=0===b('#display-form [name="'+d+'"]').length?-1!==b.inArray(d.substr(0,6),a):!b('#display-form [name="'+d+'"]').is("[type=hidden]"))&&(f[d]="");return c.live.changeParams({params:f})},getOptionParams:function(a,c){var f=a.parents("li").eq(0).find("input, select").not("[type=checkbox], [type=radio]"), e=a.parents("li").eq(0).find("input[type=checkbox], input[type=radio]").eq(0),g=0!==f.length?!0:e.is(":checked"),h;c=c?c:{};f.each(function(){h=""===b(this).val()||b(this).hasClass("placeholder")||b(this).hasClass("input-error")||a.is(e)&&e.is(":checked");c[b(this).attr("name")]=h?"":b(this).val();h||(g=!1)});c[e.attr("name")]=g?"":e.val();e.is("[type=radio]")&&b('input[name="'+e.attr("name")+'"]').not(e).each(function(){a=b(this);f=a.parents("li").eq(0).find("input, select").not("[type=checkbox], [type=radio]"); f.each(function(){c[b(this).attr("name")]=""})});return c},getOptionUrl:function(a,d){var f="";d=d?b.extend(c.live.requestStash,d):c.live.requestStash;f=c.live.getOptionParams(a,d);return f=c.live.changeParams({params:f})},changePagerNavAction:function(){var a=b("#pager-top"),d=b("#pager-value").val(),f=parseInt(c.live.events.settings.pagerValue,10)-1,e=parseInt(c.live.events.settings.pagerValue,10)+1,g=a.find("li.next a"),a=a.find("li.prev a");d!==c.live.events.settings.pagerValue&&""!==d&&(f=e= d);a.attr("href",c.live.changeParams({params:{p:f}}));g.attr("href",c.live.changeParams({params:{p:e}}))},resizePager:function(a){if(0!==b("#pager-value").length){var c=b("#pager-value"),f=1<c.val().length?c.val().length-1:1,e=c.parents(".pager").attr("rel").length,g=e-c.val().length;a=a?a:0;0<=g?c.attr("size",f).stop().animate({width:8*f+20+"px"},a).css("overflow","visible"):c.val(c.val().substring(0,e))}},transform:function(a){var d=b("#display-form"),f=b("#sidebar-categories .widget-nav li"),e= b("#sidebar-categories .widget-header a.level-up"),g=b("#add-category-to-favourites"),h=b("#add-search-to-favourites"),k=c.urlParams(),l,m;a=b.extend({href:window.location.href},a);k=c.urlParams(a.href);d.find("li").each(function(){var d=b(this),f=d.find("label").eq(0),e=d.find("input, select"),g=e.filter("[type=checkbox], [type=radio]"),h=d.find(".param-toggle").length,m={},l,p=!1,p="";g.length&&(d=0===h?b('<a class="param-toggle" href=""></a>'):d.find(".param-toggle"),(p="undefined"!==typeof k[g.attr("name")]? g.val()===k[g.attr("name")]:g.hasClass("default-value"))?(g.prop("checked",!0),d.addClass("checked"),e.filter("input[type=text], select").each(function(){b(this).is(":focus")&&!a.pop||b(this).val(decodeURI("undefined"===typeof k[b(this).attr("name")]?"":k[b(this).attr("name")]))})):(g.prop("checked",!1),d.removeClass("checked"),e.filter("input[type=text], select").each(function(){var a="undefined"!==typeof b(this).data("defaultValue")?b(this).data("defaultValue"):b(this).is("select")?b(this).find("option").eq(0).val(): "";b(this).val(a)})),e.filter("select[placeholder]").each(function(){b(this).attr("placeholder")===b(this).find(":selected").text()?b(this).addClass("placeholder"):b(this).removeClass("placeholder")}),l=g.is(":checked")||"undefined"!==typeof k[g.attr("name")]&&k[g.attr("name")]===g.val(),e.each(function(){m[b(this).attr("name")]=l?"":b(this).val()}),p=c.live.changeParams({params:m,href:a.href}),d.attr("href",p),0===h&&(f.length?(d.html("<span>"+f.html()+"</span>"),f.html(d)):d.insertAfter(g)))}); f.each(function(){var d=b(this),f=d.find("a"),e=c.urlParams(f.attr("href")),d=d.attr("id");void 0!==d&&d.match("sidebar-cat-")&&f.length&&(e=b.extend(c.urlParams(a.href),{category:"",p:"",id:"undefined"!==typeof e.id?e.id:""}),e=c.live.changeParams({params:e,href:f.attr("href").match(/[^?]*/)[0]}),f.attr("href",e))});0<e.data("parent")&&(m=c.urlParams(e.attr("href")),d=c.live.changeParams({params:b.extend(c.urlParams(a.href),{id:"undefined"!==typeof m.id?m.id:"",search_scope:"",category:""}),href:e.attr("href").match(/[^?]*/)[0]}), e.attr("href",d));0<g.length&&(l=b("#display-form #buyNowParam:checked").length,g.prop("onclick",null).click(function(a){a.preventDefault();window.location.href="/myaccount/favourites/favourites_categories.php/addNew/?catId="+b("#sidebar-categories").data("current-category-id")+"&buy="+l}));0<h.length&&(d=window.location.href,e=d.split("?"),m=e[1],h.prop("onclick",null).click(function(a){a.preventDefault();"id="===m.substr(0,3)?m="category="+m.substr(3):(m=m.replace(/\&id\=/gi,"&category="),m=m.replace(/\&search_scope=category-/gi, "&category="));window.location.href="/myaccount/favourites/favourites_search.php/addNew/?"+m}));b("#sidebar-params .widget-header .action-reset").attr("href",c.live.getClearUrl())},request:function(a){var d,f,e,g=100,h,k,l;a=b.extend({counters:!0,url:"",pop:!1,scroll:!1,callback:function(){}},a);if(a.url!==window.location.href||a.pop)c.live.requestObject&&c.live.requestObject.abort(),c.live.requestObject=b.ajax({url:a.url.replace(/listing.php/i,"items.php"),data:a.counters?{counters:1,t:1}:{t:1}, beforeSend:function(){b("#listing").trigger("beforeSend");k=(new Date).getTime();!1!==a.scroll?b(window).scrollTop(a.scroll):h=b(window).scrollTop()-b("#sidebar-params").offset().top;c.live.requestLocked||(b("#listing").append('<div id="listing-loader" class="listing-loader">'+c.labels.loading+"</div>"),b("#listing, .recommended-listing .recommended").addClass("listing-loading"));c.live.requestLocked=!0;d=b("#listing").offset().left+b("#listing").width()/2-b("#listing-loader").outerWidth()/2;e=(b(window).height()- b("#main-header.sticky #search-bar").outerHeight()-b("#listing-loader").outerHeight())/2;f=b(window).scrollTop()>b("#listing").offset().top?e:b("#listing").offset().top/2+e;b("#listing-loader").css({left:d+"px",top:f+"px"})},success:function(d){l=(new Date).getTime();g=l-k>g?0:g-(l-k);setTimeout(function(){var f=b(d).data("counters"),e=b(d).data("catcounters"),g=b(d).data("totalcounter"),k=c.views.getViewName(),l=b(d).data("headtitle");b("#listing").html(b(d).html());(f||e||g)&&c.live.changeCounters(f, e,g);c.live.requestStash={};c.preview.additionalData=null;c.live.resizePager();c.tip.init(b("#listing"));a.pop||(document.title=l,window.history.pushState({title:l},null,a.url));c.views.saveChange=!1;b(".listing-options .listing-views").find(".view-option[data-view="+k+"]").click();c.views.saveChange=!0;c.live.transform({pop:a.pop,href:a.url});c.live.autoScroll({scrollToParam:h});c.live.refreshAnalytics();c.live.restoreInitState();a.callback();b("#listing").trigger("update");c.bestmatchstats.increaseStatsCounter()}, g)},complete:function(a,d){"abort"!==d&&setTimeout(function(){c.live.requestLocked=!1;b("#listing, .recommended-listing .recommended").removeClass("listing-loading")},g)}})},refreshAnalytics:function(){c.sendAnalytics(function(){window.cm.pv();window.cm.event({cat:c.cmEventCatStringFunction(),a:"ShowListing"},c.pageViewsParamsFunction)})}},sorting:{init:function(){c.sorting.dropdown()},dropdown:function(){b("body").click(function(a){var c=b(".listing-sort-dropdown");b(a.target).closest(c.find(".label")).length? c.toggleClass("active"):c.removeClass("active")});b(".listing-sort-dropdown .options dl dd a").click(function(a){b.cookie("order",b(this).parent().data("order"),{path:"/",domain:b(".main-search").data("cookie-domain")})})}},urlParams:function(a){var b={};a=a?a:window.location.href;a.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,c,g){b[decodeURI(c)]=g});return b},sidebar:{init:function(){var a=void 0!==document.createElement("input").placeholder,d=parseInt(b("#main-breadcrumb-search-hits").text().match(/\d+/), 10),f=c.urlParams(),e=b("#main-search");b("#sidebar-categories .widget-header").data("helptipBody")&&b("#sidebar-categories .widget-header").helptip({event:"display",tStart:0,tStop:7E3,pos:"r",css:"vela-listing-tip"});e.data("helptipBody",b("#sidebar-categories .widget-header").data("helptipDescriptionBody"));b("#sidebar-categories .widget-header").data("helptipDescriptionBody")&&e.helptip({event:"display",tStart:0,tStop:7E3,pos:"r",css:"vela-listing-tip"});0===d&&f.requestDescription&&e.find(".in-description input").prop("checked", !1).val(0);a||c.sidebar.addPlaceholders();c.sidebar.styleSelects();c.sidebar.scrolls.init();c.sidebar.seo();c.live.events.popWindowScroll();b("#sidebar-categories .widget-nav li").on("click",c.sidebar.categoryClick)},addPlaceholders:function(){b("#sidebar-params input[type=text]").each(function(){var a=b(this);a.focus(function(){a.val()===a.attr("placeholder")&&a.val("").removeClass("placeholder")}).blur(function(){""!==a.val()&&a.val()!==a.attr("placeholder")||a.val(a.attr("placeholder")).addClass("placeholder")}); ""===a.val()&&a.val(a.attr("placeholder")).addClass("placeholder")})},categoryClick:function(a){var c=b(this).find("a").attr("href");!c||1!==a.which||a.ctrlKey||a.metaKey||a.shiftKey||(location.href=c)},styleSelects:function(){b.browser.opera||b.browser.msie||b("#sidebar-params form select").each(function(){b(this).wrap('<div class="styled-select" />')});b("#sidebar-params form select[placeholder]").each(function(){var a=b(this);a.change(function(){a.attr("placeholder")===a.find(":selected").text()? a.addClass("placeholder"):a.removeClass("placeholder")});a.attr("placeholder")===a.find(":selected").text()&&a.addClass("placeholder")})},scrolls:{settings:{itemsCollapsed:5,itemsExpanded:10},init:function(){var a=window.sessionStorage&&window.sessionStorage.getItem("toggleList")&&JSON.parse(window.sessionStorage.getItem("toggleList"));b(".sidebar .widget-params fieldset ul").not(".params-limit-all").each(function(){var d=b(this),f=b(b("#sidebar-params-toggle-link").html()),e=a&&a.toggleListIndex=== b(this).index(".sidebar .widget-params fieldset ul")&&a.toggleListExpand?"params-limit-less":"params-limit-more",g,h;d.find("li").length<=c.sidebar.scrolls.settings.itemsCollapsed||(d.wrap('<div class="overview" />'),d.parents(".overview").wrap('<div class="viewport" />'),d.parents(".viewport").wrap('<div class="scrollbar-area" />'),g=d.parents(".scrollbar-area"),g.addClass(e),g.prepend('<div class="scrollbar"><div class="track"><div class="thumb"></div></div></div>'),d=d.find("li"),d.each(function(a){h= b(this).find(".count").text().match(/\d+/);b(this).attr("data-default-order",a+1).data("defaultOrder",a+1).attr("data-custom-order",h?h[0]:"").data("customOrder",h?h[0]:"")}),g.append(f),f.on("click",c.sidebar.scrolls.toggleList),f.trigger("click",[a&&a.toggleListOffset?a.toggleListOffset:0]))})},toggleList:function(a,d){var f=b(this).parents(".scrollbar-area"),e=f.find("ul"),g=!f.hasClass("params-limit-more"),h=!1,k;f.toggleClass("params-limit-more",g);f.toggleClass("params-limit-less",!g);e.html(c.sidebar.scrolls.getSortedList(e, g));k=c.sidebar.scrolls.getListHeight(e,g);h=e[0].scrollHeight<=k+2;f.find(".viewport").css({height:k}).end();f.tinyscrollbar({invertscroll:c.isMobile,size:k,scroll:g&&!h});f.tinyscrollbar_update(d);f.toggleClass("params-limit-all",h);return!1},refreshScrollbarArea:function(){var a=b(this),d=a.find("ul"),f=a.hasClass("params-limit-more"),e=!1,g;d.length&&(g=c.sidebar.scrolls.getListHeight(d,f),e=d[0].scrollHeight<=g+2,a.find(".viewport").css({height:g}).end(),a.tinyscrollbar({invertscroll:c.isMobile, size:g,scroll:f&&!e}),a.toggleClass("params-limit-all",e));return!1},defaultOrder:function(a){return a.sort(function(a,c){return b(a).attr("data-default-order")-b(c).attr("data-default-order")})},customOrder:function(a){return a.sort(function(a,c){var e=0,e=!b(a).find(".param-toggle").hasClass("checked")&&b(c).find(".param-toggle").hasClass("checked")?1:b(a).find(".param-toggle").hasClass("checked")&&!b(c).find(".param-toggle").hasClass("checked")?-1:!b(a).hasClass("selected")&&b(c).hasClass("selected")? 1:b(a).hasClass("selected")&&!b(c).hasClass("selected")?-1:b(c).attr("data-custom-order")-b(a).attr("data-custom-order");0===e&&(e=b(a).attr("data-default-order")-b(c).attr("data-default-order"));return e})},getSortedList:function(a,b){var f=a.find("li");return b?c.sidebar.scrolls.defaultOrder(f.clone()):c.sidebar.scrolls.customOrder(f.clone())},getListHeight:function(a,c){var f=0,e=!1,g=0,h=c?10:5;a.find("li").each(function(){if(e=!c&&g>=h&&0===b(this).find(".param-toggle.checked").length||c&&g>= h)return!1;f+=b(this).outerHeight(!0);g++});return f}},seo:function(){var a=b(".seo-module"),c=b(".seo-module .content"),f=c.height();a.find("a").click(function(a){a.stopPropagation()});0<a.length&&(a.toggle(function(){var b=c.css("height","auto").height();c.height(f).animate({height:b});a.addClass("active")},function(){c.animate({height:f});a.removeClass("active")}),b("#listing").on("beforeSend",function(){a.remove()}))}},views:{saveChange:!1,init:function(){c.sendAnalytics(function(){window.cm.event({cat:c.cmEventCatStringFunction(), a:"ShowListing"},c.pageViewsParamsFunction)});b("#listing").on("click",".listing-options .listing-views > .view-option",c.views.change).on("mouseenter",".listing-options .listing-views > .view-option",c.views.preview.show).on("mouseleave",".listing-options .listing-views > .view-option",c.views.preview.hide);b('.listing-options .listing-views > .view-option[data-view="'+c.views.getViewName()+'"]').click();c.views.saveChange=!0;b(window).resize(function(){c.views.resize()});b(window).resize()},getViewName:function(){var a= b(".listing-options .listing-views").find(".view-option[data-view="+b.cookie("listingViewOption")+"]").length,d="",f=c.urlParams(),e=b(".listing-options .listing-views").find(".view-option[data-view="+f.bmatchView+"]").length;f.view&&"gal"===f.view?d="listing-gallery":a&&(d=b.cookie("listingViewOption"));""===d&&e&&f.bmatchView&&(d=f.bmatchView);""===d&&(d="listing-normal");return d},change:function(){b(this).is(".view-option")&&(b(this).addClass("current").parents(".listing").eq(0).addClass(b(this).data("view")), b(this).siblings().each(function(){b(this).removeClass("current").parents(".listing").eq(0).removeClass(b(this).data("view"))}),c.views.saveChange&&b.cookie("listingViewOption",b(this).data("view"),{path:"/"}));"listing-gallery"===b(this).data("view")?(c.views.resizeGallery(),c.preview.settings.showDelay=450):(c.views.reset(),c.preview.settings.showDelay=300);c.views.loadThumbs();return!1},preview:{el:b('<div id="listing-preview" class="listing listing-preview"></div>').appendTo("body"),showTimeout:null, closeTimeout:null,settings:{showDelay:400,closeDelay:0},show:function(){var a=b(this),d=c.views.preview.el,f;b.browser.msie&&9>b.browser.version||b("#listing").hasClass(a.data("view"))||c.isMobile||(c.views.preview.showTimeout=setTimeout(function(){d.html("");d.attr("class","listing listing-preview").addClass(b(a).data("view"));f=b("#listing").clone().find(".photo").css("height","").end().find(".photo .inner").css("width","").css("height","").end();f.find(".photo").each(function(){var a=b(this).data("img"); a.length?b(this).find(".inner").css({"background-image":"url("+a[0][1]+")"}):b(this).find(".inner").css({"background-image":""})});d.append(f.find(".offer:lt(9)"));d.css({position:"absolute",top:-(.6*b("#listing-preview").height())/2+a.offset().top+13+"px",left:-(.6*b("#listing-preview").width())+a.offset().left+220+"px"}).show()},c.views.preview.settings.showDelay),clearTimeout(c.views.preview.closeTimeout))},hide:function(){clearTimeout(c.views.preview.showTimeout);c.views.preview.closeTimeout= setTimeout(function(){c.views.preview.el.html("").hide()},c.views.preview.settings.closeDelay)}},reset:function(){b(this.photoSelector).css("height","");b(this.photoInnerSelector).css("width","").css("height","")},resize:function(){c.views.resizeGallery()},resizeGallery:function(){if(b("#listing").hasClass("listing-gallery")){var a=b("#listing .offer").width()-26,c=a/240*180;b(this.photoSelector).css("height",c+"px");b(this.photoInnerSelector).css("width",a+"px").css("height",c+"px")}},loadThumbs:function(){function a(a){var b= a.data("img"),c=null;b.length&&(a.addClass("loading"),c=new Image,c.onload=function(){a.find(".inner").css({"background-image":"url("+b[0][f]+")"}).end().removeClass("loading")},c.onerror=function(){a.removeClass("loading")},c.src=b[0][f])}function d(){h=[];k=b(window).scrollTop();l=b(window).height();b.each(g,function(c,d){if(d<k||-1!==b.inArray(c,h))return!0;if(d<k+l+e[c].parents(".offer").height())a(e[c]),h.push(c);else return!1});h.reverse();b.each(h,function(a,b){g.splice(b,1);e.splice(b,1)})} var f=1,e=[],g=[],h=[],k,l;b("#listing").is(".listing-simple")?f=0:b("#listing").is(".listing-gallery")&&(f=2);b(c.photoSelector).each(function(a,c){c=b(c);c.data("img")&&c.data("img").length&&(e.push(c),g.push(c.offset().top))});b(window).unbind("scroll.watchThumbs").unbind("resize.watchThumbs").bind({"scroll.watchThumbs":d,"resize.watchThumbs":d});d()}},search:{extend:function(){var a="";b("#display-form li input:checked").each(function(){b(this).parent().find("input, select").each(function(){var c= a,f='<input type="hidden" name="'+b(this).attr("name")+'" value="',e=b(this).val();"string"===typeof e&&(e=e.replace(/&/g,"&amp;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/'/g,"&#039;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"));a=c+(f+e+'" />')})});b(this).append(a)}},message:{init:function(){var a=c.urlParams();"undefined"!==typeof a.messageType&&null!==a.messageType&&"undefined"!==typeof a.success&&("category"===a.messageType?c.message.determineCategoryPopup(a.success):"seller"===a.messageType&& c.message.determineSellerPopup(a.success));b("#listing .listing-message .sub-message a").on("click",c.message.action)},action:function(a){a.preventDefault();"category"===b("#listing .listing-message").data("messageType")?c.message.checkFavouriteCategories():"seller"===b("#listing .listing-message").data("messageType")&&c.message.checkFavouriteSellers()},checkFavouriteCategories:function(){b.ajax({type:"POST",data:{id:b('form[name="display-form"] input[name="id"]').val(),token:b('form[name="display-form"]').data("token")}, url:"/myaccount/favourites/favouritesCategories.php/checkAndAddAjax",statusCode:{401:function(){var a=b('<form method="post" action="/myaccount/favourites/favouritesCategories.php/redirect"></form>');a.html('<input type="hidden" id="referer" name="referer" value="'+window.location.href+'" /><input type="hidden" id="category" name="category" value="'+b('form[name="display-form"] input[name="id"]').val()+'" />');a.appendTo(b("body"));a.submit()}},success:function(a){c.message.determineCategoryPopup(a.success)}})}, checkFavouriteSellers:function(){b.ajax({type:"POST",data:{id:b('form[name="display-form"] input[name="us_id"]').val(),token:b('form[name="display-form"]').data("token")},url:"/myaccount/favourites/favouritesSellers.php/checkAndAddAjax",statusCode:{401:function(){var a=b('<form method="post" action="/myaccount/favourites/favouritesSellers.php/redirect"></form>');a.html('<input type="hidden" id="referer" name="referer" value="'+window.location.href+'" /><input type="hidden" id="seller" name="seller" value="'+ b('form[name="display-form"] input[name="us_id"]').val()+'" />');a.appendTo(b("body"));a.submit()}},success:function(a){c.message.determineSellerPopup(a.success)}})},determineCategoryPopup:function(a){var d=b(".listing-message").data("messages");switch(a){case 2:case "2":c.message.displayPopoverMessage(d.categoryAlreadyInFavs,d.categoryAlreadyInFavsSub);break;case 1:case "1":case !0:c.message.displayPopoverMessage(d.categoryAdded,d.categoryAddedSub);break;default:c.message.displayPopoverMessage(d.genericError, d.genericErrorSub)}},determineSellerPopup:function(a){var d=b(".listing-message").data("messages");switch(a){case 2:case "2":c.message.displayPopoverMessage(d.userAlreadyInFavs,d.userAlreadyInFavsSub);break;case 1:case "1":case !0:c.message.displayPopoverMessage(d.userAdded,d.userAddedSub);break;default:c.message.displayPopoverMessage(d.genericError,d.genericErrorSub)}},displayPopoverMessage:function(a,c){var f=b("#listing-message-modal");f.find(".modal-header h3").html(a);f.find(".modal-body").html(c); f.modal({show:!0}).css({"margin-top":"-120px","margin-left":-(f.outerWidth()/2)+"px"})}},tip:{init:function(a){var c=b.parseJSON(b("#listing-icon-info").html());a=a?a:b("body");b(".icon-as",a).helptip({event:"hover",tStart:0,pos:"r",css:"vela-listing-tip sa-tip",hoverDelay:0,customBody:c.standardAllegro});b(".icon-fs",a).helptip({event:"hover",tStart:0,pos:"r",css:"vela-listing-tip sa-tip",hoverDelay:0,customBody:c.freeShipping});b(".icon-fr",a).helptip({event:"hover",tStart:0,pos:"r",css:"vela-listing-tip sa-tip", hoverDelay:0,customBody:c.freeReturn});b(".icon-lp",a).helptip({event:"hover",tStart:0,pos:"r",css:"vela-listing-tip lp-tip",hoverDelay:0,customBody:c.loyaltyProgram});b(".icon-pi",a).helptip({event:"hover",tStart:0,pos:"r",css:"vela-listing-tip pi-tip",hoverDelay:0,customBody:c.installmentAvailable})}},bestmatchstats:{init:function(){var a=c.urlParams(),d,f,e=parseInt(b("#main-breadcrumb-search-hits").text().match(/\d+/),10);d=b("div.listing-sort-dropdown div.options dd.selected").data("order"); f=b("#breadcrumbs-list").data("cat-path-ids");var g=0;localStorage&&(f=f?f.toString().split(","):[],0<f.length&&(g=f[f.length-1]),a.order=a.order?a.order:d,(d=b.parseJSON(localStorage.getItem("bestMatchStats")))&&d.phrase&&a.string?(f=Math.abs(d.phrase.length-a.string.length),2<c.bestmatchstats.levenshtein(d.phrase,a.string)-f&&"dym"!==a.mode?c.bestmatchstats.initStats(a.string,g,a.mode,a.order,a.bmatch,e):c.bestmatchstats.setStats(d,a.string,g,a.mode,a.order,a.bmatch,e)):c.bestmatchstats.initStats(a.string, g,a.mode,a.order,a.bmatch,e))},setStats:function(a,b,c,e,g,h,k){a.phrase=b?decodeURI(b.replace(/\+/g," ")):"";a.category=c;"dym"===e&&(a.isDidYouMean=!0);"desc"===e&&(a.isDescription=!0);g&&(a.order=g);h&&(a.scenario=h);a.count++;a.resultsCount=k;localStorage.setItem("bestMatchStats",JSON.stringify(a))},increaseStatsCounter:function(){var a,d=c.urlParams(),f=parseInt(b("#main-breadcrumb-search-hits").text().match(/\d+/),10);localStorage&&(a=b.parseJSON(localStorage.getItem("bestMatchStats")))&&(d.order&& (a.order&&a.order===d.order||(a.changedSort=!0),a.order=d.order),d.bmatch&&(a.scenario=d.bmatch),a.count++,a.resultsCount=f,localStorage.setItem("bestMatchStats",JSON.stringify(a)))},clickItem:function(a){var d;a=c.urlParams();var f=a.limit?a.limit:60;a=a.page?(a.page-1)*f:0;var e=0,g=0,h=b(this).data("id"),k=[];d=f="";var l=b(this).attr("class"),m,n=(new Date).getTime()/1E3;if(localStorage&&(d=b.parseJSON(localStorage.getItem("bestMatchStats")))&&(b(".offer").each(function(a){parseInt(b(".offer:eq("+ a+")").data("id"),10)===parseInt(h,10)&&(e=a+1)}),g=a+e,b(".offer").each(function(a){a>=e-4&&a<e-1&&k.push(b(".offer:eq("+a+")").data("id"))}),d.pos=g,d.id=h,d.worseItems=k,d.time=d.startTime?n-d.startTime:0,localStorage.setItem("bestMatchStats",JSON.stringify(d)),l&&l.match(/item\-cart/g)&&l.match(/item\-cart/g).length)){for(m in d)f+="/bm_"+m+","+encodeURI(d[m]);(d=b(this).attr("href"))&&b(this).attr("href",d+f)}},initStats:function(a,b,c,e,g,h){a={phrase:a?decodeURI(a.replace(/\+/g," ")):"",count:1, isDidYouMean:"dym"===c,isDescription:"desc"===c,changedSort:!1,worseItems:[],order:e,scenario:g,pos:0,id:0,startTime:(new Date).getTime()/1E3,resultsCount:h,category:b};localStorage.setItem("bestMatchStats",JSON.stringify(a))},levenshtein:function(a,b){var c=[],e,g;if(0===parseInt(a.length,10))return b.length;if(0===parseInt(b.length,10))return a.length;for(e=0;e<=b.length;e++)c[e]=[e];for(g=0;g<=a.length;g++)c[0][g]=g;for(e=1;e<=b.length;e++)for(g=1;g<=a.length;g++)b.charAt(e-1)===a.charAt(g-1)? c[e][g]=c[e-1][g-1]:c[e][g]=Math.min(c[e-1][g-1]+1,Math.min(c[e][g-1]+1,c[e-1][g]+1));return c[b.length][a.length]}},brandzoneFeatures:{init:function(){this.isBrandzone&&(this.addBrandzoneClassToBody(),this.showBackground(),this.tabs.init())},isBrandzone:b(".main-title h1").data("brandzone-enabled"),addBrandzoneClassToBody:function(){b("body").addClass("brandzone")},showBackground:function(){var a;1210<b(window).width()&&(a=b("h1.brandzone").data("background-image-link"),"undefined"!==typeof a&&(b("body").prepend('<div class="backgroundWrapper" style="background-image:url('+ a+')"></div>'),b(".backgroundWrapper").addClass("visible")))},tabs:{init:function(){this.selectCorrectList();this.uiTabsInit();this.tabsService.urlsBack()},selectCorrectList:function(){var a=this;b.widget("ui.tabs",b.ui.tabs,{_getList:function(){var b=this.element.find(a.tabsService.tabsSelector);return b.length?b.eq(0):this._super()}})},uiTabsInit:function(){var a=this,d,f;b("#pagecontent1").tabs({select:function(d,g){f=b(g.tab).data("brand-tab-index");"undefined"!==typeof f&&!1!==f?a.tabsService.getAndLoadTabContent(f, g.tab):setTimeout(c.brandzoneFeatures.refreshTagsList,250);a.tabsService.addRemoveActiveClass(g.tab);d.currentTarget&&a.urlsService.changeUrl(g.index,g.tab.hash)},show:200,hide:200});d=this.tabsService.getTabIndexFromHash();this.tabsService.addRemoveActiveClass(b(this.tabsService.tabsSelector+" li")[d]);b("#pagecontent1").tabs("option","active",d);d&&1!==d&&a.tabsService.getAndLoadTabContent(d-2,b(this.tabsService.tabsSelector+" a")[d]);b("#sidebar, #listing, #listing-banner").show();b(window).on("popstate", function(){a.tabsService.getTabIndexFromHash()&&b("#pagecontent1").tabs("option","active",a.tabsService.getTabIndexFromHash())})},tabsService:{uiTabs:null,tabsSelector:".brandzone-tabs",defaultTabIndex:1,urlsBack:function(){b(this.tabsSelector+" .non-tab-link").each(function(a,c){var f=b(c).data("target-url"),f=b(c).clone().attr("href",f);b(c).replaceWith(f[0].outerHTML)})},addRemoveActiveClass:function(a){b(this.tabsSelector).find("li").removeClass("active");b(a).closest("li").addClass("active")}, getTabIndexFromHash:function(){if(window.location.hash){var a=this.defaultTabIndex;b(this.tabsSelector+" a").each(function(b,c){c.hash===window.location.hash&&(a=b)});return a}return this.defaultTabIndex},getAndLoadTabContent:function(a,d){var f=b("#tab-"+a),e=b("input[name=us_id]").val();f.html('<div id="listing-loader" class="listing-loader">'+c.labels.loading+"</div>");b.get("listing.php/getBrandZoneTabData?us_id="+e+"&tabIndex="+a,function(a){a.brandZoneTabData&&a.brandZoneTabData.content?(f.html(a.brandZoneTabData.content), b(d).data("brand-tab-index",!1)):f.html('<div class="alert alert-danger">'+c.labels.tabLoadingError+"</div>")})}},urlsService:{urlHash:window.location.hash,locationPathAndSearch:function(){var a=window.location.search.match(/us_id=([^&]+)/);return window.location.pathname+"?"+(a?a[0]:"")},brandzoneItemsHref:null,changeUrl:function(a,b){null===this.brandzoneItemsHref&&(this.brandzoneItemsHref=window.location.pathname+window.location.search);1!==a?history.pushState(null,"",this.locationPathAndSearch()+ b):(history.pushState(null,"",this.brandzoneItemsHref),this.brandzoneItemsHref=null)}}},refreshTagsList:function(){b.proxy(c.sidebar.scrolls.refreshScrollbarArea,b(".widget-tags .scrollbar-area"))()}}};c.init()});